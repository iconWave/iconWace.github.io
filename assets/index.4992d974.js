var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=Math.pow,i=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,u=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&i(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&i(e,n,t[n]);return e},s=(e,a)=>t(e,n(a)),d=(e,t)=>{var n={};for(var l in e)r.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&o.call(e,l)&&(n[l]=e[l]);return n},c=(e,t,n)=>new Promise(((a,r)=>{var o=e=>{try{i(n.next(e))}catch(t){r(t)}},l=e=>{try{i(n.throw(e))}catch(t){r(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);i((n=n.apply(e,t)).next())}));import{S as v,j as f,a as m,d as p,r as y,T as h,t as g,z as b,B as _,C as w,l as E,U as T,E as O,a7 as k,a0 as S,a4 as C,W as F,V as K,am as R,ao as D,ap as I,aq as P,an as j,ar as x,_ as L,al as A,as as M,G as U,f as Y,w as q,o as W,p as N,u as B,ad as z,k as H,J as Q,at as $,D as V,au as G,av as J,a9 as X}from"./antdv.1e116ac1.js";import{u as Z,a as ee,_ as te}from"./index.754b7dd5.js";function ne(){const e=Z();return{hasPermission:function(t,n=!0){var a;return t?1===e.getIsAdmin||(ee(t)?!ee(t)||v(t,e.getAuths).length>0:null==(a=e.getAuths)?void 0:a.includes(t)):n}}}function ae(){const e=Z();return{hasRole:function(t,n=!0){return null==t?n:"boolean"==typeof t?t:"number"==typeof t?e.getRole===t:n}}}const re=f({props:["hiddenFilter","button","items","model"],emits:["search"],setup(e,{emit:t}){const{hasPermission:n}=ne(),{hasRole:a}=ae(),r=m(e.model||{}),o=p((()=>(e.items||[]).map((e=>u({type:"input"},e))))),l=y(e.hiddenFilter);h((()=>{e.button||e.items||(l.value=!0)}));const i=p((()=>{const t=g(e.button)||{};return s(u({},t),{permission:n(t.auth)&&a(t.role)})}));return{formModel:r,getItems:o,hasHidden:l,getButton:i,handleSubmit:()=>{t("search")}}}}),oe={key:0,class:"text"},le=C("查询");const ie=te(re,[["render",function(e,t,n,a,r,o){const l=R,i=D,u=I,s=P,d=j,c=x,v=L,f=A,m=M,p=U;return e.hasHidden?k("",!0):(b(),_(p,{key:0,"body-style":{padding:"0 0 24px 0"},bordered:!1},{default:w((()=>[E(m,{class:"form-container",layout:"horizontal",model:e.formModel},{default:w((()=>[E(f,{type:"flex"},{default:w((()=>[e.button?(b(),_(i,{key:0,flex:"100px"},{default:w((()=>{var t;return["text"===e.button.type?(b(),T("span",oe,O(e.button.label),1)):k("",!0),e.getButton.permission?(b(),_(l,S({key:1},e.button,{onClick:null==(t=e.button)?void 0:t.onClick}),{default:w((()=>[C(O(e.button.label),1)])),_:1},16,["onClick"])):k("",!0)]})),_:1})):k("",!0),E(i,{flex:"auto",class:"rowE"},{default:w((()=>[E(v,null,{default:w((()=>[(b(!0),T(K,null,F(e.getItems,(t=>(b(),_(c,{key:t.name,name:t.name},{default:w((()=>["select"===t.type?(b(),_(u,S({key:0,key:`select-${t.name}`},t,{value:e.formModel[t.name],"onUpdate:value":n=>e.formModel[t.name]=n,class:"default-select-w"}),null,16,["value","onUpdate:value"])):"date"===t.type?(b(),_(s,S({key:1,key:`date-${t.name}`},t,{value:e.formModel[t.name],"onUpdate:value":n=>e.formModel[t.name]=n,class:"default-select-w"}),null,16,["value","onUpdate:value"])):(b(),_(d,S({key:2},t,{key:`input-${t.name}`,value:e.formModel[t.name],"onUpdate:value":n=>e.formModel[t.name]=n,onSearch:t.search,class:"default-search-w"}),{enterButton:w((()=>[E(l,{type:"primary"},{default:w((()=>[le])),_:1})])),_:2},1040,["value","onUpdate:value","onSearch"]))])),_:2},1032,["name"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}))}],["__scopeId","data-v-ef3fa19d"]]),ue={},se=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),de=()=>ue;f({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:t}){const{config:n}=e;return N(se,n),()=>{var e;return null===(e=t.default)||void 0===e?void 0:e.call(t)}}});const ce=Object.prototype.toString,ve=e=>ce.call(e),fe=e=>"[object Object]"===ve(e),me=e=>null!==e&&"object"==typeof e,pe=e=>e instanceof Function,ye=e=>null==e,he="undefined"==typeof window,ge=()=>{var e,t;return!he&&"visible"===(null===(e=window)||void 0===e||null===(t=e.document)||void 0===t?void 0:t.visibilityState)},be=()=>{var e,t,n;return null===(e=!he&&(null===(t=window)||void 0===t||null===(n=t.navigator)||void 0===n?void 0:n.onLine))||void 0===e||e},_e=Promise.resolve(null),we=(...e)=>c(void 0,null,(function*(){const t=yield fetch(...e);if(t.ok)return t.json();throw new Error(t.statusText)})),Ee=(e,t,n)=>{const a=t.replace(/\[(\d+)\]/g,".$1").split(".");let r=e;for(const o of a)if(r=Object(r)[o],void 0===r)return n;return r};const Te=(e,t=!1)=>{if(t)return new Error(`Warning: [vue-request] ${e}`)};var Oe;const ke=new Set,Se=new Set,Ce=new Set,Fe=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=ke;break;case"RECONNECT_LISTENER":n=Ce;break;case"VISIBLE_LISTENER":n=Se}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},Ke=e=>{e.forEach((e=>{e()}))};function Re(e,t,n){let a,r,o,l,i,u,s=0,d=!1,c=!1,v=!0;const f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){const n=a,o=r;return a=r=void 0,s=t,l=e.apply(o,n),l}function p(e,t){return f?(window.cancelAnimationFrame(i),window.requestAnimationFrame(e)):setTimeout(e,t)}function y(e){const n=e-u;return void 0===u||n>=t||n<0||c&&e-s>=o}function h(){const e=Date.now();if(y(e))return g(e);i=p(h,function(e){const n=e-s,a=t-(e-u);return c?Math.min(a,o-n):a}(e))}function g(e){return i=void 0,v&&a?m(e):(a=r=void 0,l)}function b(...e){const n=Date.now(),o=y(n);if(a=e,r=this,u=n,o){if(void 0===i)return function(e){return s=e,i=p(h,t),d?m(e):l}(u);if(c)return i=p(h,t),m(u)}return void 0===i&&(i=p(h,t)),l}return t=+t||0,me(n)&&(d=!!n.leading,c="maxWait"in n,o=c?Math.max(+n.maxWait||0,t):o,v="trailing"in n?!!n.trailing:v),b.cancel=function(){void 0!==i&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(i),s=0,a=u=r=i=void 0},b.flush=function(){return void 0===i?l:g(Date.now())},b.pending=function(){return void 0!==i},b}function De(e,t){for(const a in t)void 0!==t[a]&&(me(t[a])&&me(e[a])&&a in e?(fe(t[a])||(n=t[a],Array.isArray(n)))&&De(e[a],t[a]):e[a]=t[a]);var n}function Ie(e,...t){const n=Object.assign({},e);if(!t.length)return n;for(const a of t)De(n,a);return n}!he&&null!==(Oe=window)&&void 0!==Oe&&Oe.addEventListener&&(window.addEventListener("visibilitychange",(()=>{ge()&&Ke(Se)}),!1),window.addEventListener("focus",(()=>Ke(ke)),!1),window.addEventListener("online",(()=>Ke(Ce)),!1));const Pe=(e,t,n)=>{var a,r,o;const{initialAutoRunFlag:i,initialData:u,loadingDelay:s,pollingInterval:d,debounceInterval:c,debounceOptions:v,throttleInterval:f,throttleOptions:m,pollingWhenHidden:h,pollingWhenOffline:g,errorRetryCount:b,errorRetryInterval:_,stopPollingWhenHiddenOrOffline:w,refreshOnWindowFocus:E,refocusTimespan:T,updateCache:O,formatResult:k,onSuccess:S,onError:C,onBefore:F,onAfter:K}=t,R=y(0),D=y(null!==(a=null==n?void 0:n.loading)&&void 0!==a&&a),I=y(null!==(r=null==n?void 0:n.data)&&void 0!==r?r:u),P=y(null==n?void 0:n.error),j=y(null!==(o=null==n?void 0:n.params)&&void 0!==o?o:[]),x=(L={loading:D,data:I,error:P,params:j},A=[e=>O(e)],e=>{Object.keys(e).forEach((t=>{L[t].value=e[t]})),A.forEach((e=>e(L)))});var L,A;const M=()=>{R.value=0},U=y(0),Y=y(),q=y(),W=y(),N=()=>{Y.value&&Y.value(),W.value&&W.value(),q.value&&q.value()},B=p((()=>{if(_)return _;return 1e3*Math.floor(Math.random()*l(2,Math.min(R.value,9))+1)})),z=(...t)=>{x({loading:!s,params:t}),W.value=(()=>{let e;return s&&(e=setTimeout(x,s,{loading:!0})),()=>e&&clearTimeout(e)})(),U.value+=1;const n=U.value;return null==F||F(t),e(...t).then((e=>{if(n===U.value){const n=k?k(e):e;return x({data:n,loading:!1,error:void 0}),S&&S(n,t),M(),n}return _e})).catch((e=>(n===U.value&&(x({data:void 0,loading:!1,error:e}),C&&C(e,t)),_e))).finally((()=>{n===U.value&&(W.value(),q.value=(e=>{let t;const n=-1===b,a=R.value<b;return P.value&&(n||a)&&(n||(R.value+=1),t=setTimeout(e,B.value)),()=>t&&clearTimeout(t)})((()=>z(...t))),Y.value=(e=>{if(P.value&&0!==b)return;let t;if(!ye(d)&&d>=0){if(!h&&!ge()||!g&&!be())return void(w.value=!0);t=setTimeout(e,d)}return()=>t&&clearTimeout(t)})((()=>z(...t))),null==K||K(t))}))},H=!ye(c)&&Re(z,c,v),Q=!ye(f)&&function(e,t,n){let a=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return me(n)&&(a="leading"in n?!!n.leading:a,r="trailing"in n?!!n.trailing:r),Re(e,t,{leading:a,trailing:r,maxWait:t})}(z,f,m),$=(...e)=>(N(),!i.value&&H?(H(...e),_e):Q?(Q(...e),_e):(M(),z(...e))),V=()=>$(...j.value),G=[],J=e=>{e&&G.push(e)},X=()=>{w.value&&(h||ge())&&(g||be())&&(V(),w.value=!1)};h||J(Fe("VISIBLE_LISTENER",X)),g||J(Fe("RECONNECT_LISTENER",X));const Z=((e,t)=>{let n=!1;return(...a)=>{n||(n=!0,e(...a),setTimeout((()=>{n=!1}),t))}})(V,T);E&&(J(Fe("VISIBLE_LISTENER",Z)),J(Fe("FOCUS_LISTENER",Z)));return{loading:D,data:I,error:P,params:j,run:$,cancel:()=>{U.value+=1,x({loading:!1}),H&&H.cancel(),Q&&Q.cancel(),N()},refresh:V,mutate:e=>{const t=pe(e)?e(I.value):e;x({data:t})},unmount:()=>{G.forEach((e=>e()))}}},je=new Map,xe=e=>{if(ye(e))return;const t=je.get(e);return t?{data:t.data,cacheTime:t.cacheTime}:void 0};function Le(e,t){const n=Y(se,{}),a=u(u(u({},de()),n),t),{cacheKey:r,defaultParams:o=[],manual:l=!1,ready:i=y(!0),refreshDeps:c=[],loadingDelay:v=0,pollingWhenHidden:f=!1,pollingWhenOffline:h=!1,refreshOnWindowFocus:g=!1,refocusTimespan:b=5e3,cacheTime:_=6e5,staleTime:w=0,errorRetryCount:E=0,errorRetryInterval:T=0,queryKey:O}=a,k=d(a,["cacheKey","defaultParams","manual","ready","refreshDeps","loadingDelay","pollingWhenHidden","pollingWhenOffline","refreshOnWindowFocus","refocusTimespan","cacheTime","staleTime","errorRetryCount","errorRetryInterval","queryKey"]),S=y(!1),C=y(!1),F=u({initialAutoRunFlag:C,loadingDelay:v,pollingWhenHidden:f,pollingWhenOffline:h,stopPollingWhenHiddenOrOffline:S,cacheKey:r,errorRetryCount:E,errorRetryInterval:T,refreshOnWindowFocus:g,refocusTimespan:b,updateCache:e=>{var t,n;if(!r)return;const a=null===(t=xe(r))||void 0===t?void 0:t.data,o=null==a?void 0:a.queries,l=(e=>{const t={};return Object.keys(e).forEach((n=>{t[n]=B(e[n])})),t})(e),i=null!==(n=null==O?void 0:O(...e.params.value))&&void 0!==n?n:"__QUERY_DEFAULT_KEY__";((e,t,n)=>{const a=je.get(e);null!=a&&a.timer&&clearTimeout(a.timer);const r=setTimeout((()=>je.delete(e)),n);je.set(e,{data:t,timer:r,cacheTime:(new Date).getTime()})})(r,{queries:s(u({},o),{[i]:u(u({},null==o?void 0:o[i]),l)}),latestQueriesKey:i},_)}},function(e,t){const n=Object.assign({},e);for(const a of t)delete n[a];return n}(k,["pagination","listKey"])),K=y(!1),R=y(),D=y(),I=y(),P=m({__QUERY_DEFAULT_KEY__:m(Pe(e,F))}),j=y("__QUERY_DEFAULT_KEY__"),x=p((()=>{var e;return null!==(e=P[j.value])&&void 0!==e?e:{}}));if(q(x,(e=>{K.value=e.loading,R.value=e.data,D.value=e.error,I.value=e.params}),{immediate:!0,deep:!0}),r){var L;const t=xe(r);null!=t&&null!==(L=t.data)&&void 0!==L&&L.queries&&(Object.keys(t.data.queries).forEach((n=>{const a=t.data.queries[n];P[n]=m(Pe(e,F,{loading:a.loading,params:a.params,data:a.data,error:a.error}))})),t.data.latestQueriesKey&&(j.value=t.data.latestQueriesKey))}const A=y(),M=y(!1),U=(...t)=>{var n;if(!i.value&&!M.value)return A.value=t,_e;const a=null!==(n=null==O?void 0:O(...t))&&void 0!==n?n:"__QUERY_DEFAULT_KEY__";return P[a]||(P[a]=m(Pe(e,F))),j.value=a,x.value.run(...t)},N=()=>{Object.keys(P).forEach((e=>{P[e].cancel(),P[e].unmount(),delete P[e]}))};if(!l){var z;C.value=!0;const e=xe(r),t=null!==(z=null==e?void 0:e.data.queries)&&void 0!==z?z:{},n=e&&(-1===w||e.cacheTime+w>(new Date).getTime()),a=Object.keys(t).length>0;n||(a?Object.keys(P).forEach((e=>{var t;null===(t=P[e])||void 0===t||t.refresh()})):U(...o)),C.value=!1}const H=y();return H.value=q(i,(e=>{M.value=!0,e&&A.value&&(U(...A.value),H.value())}),{flush:"sync"}),c.length&&q(c,(()=>{!l&&x.value.refresh()})),W((()=>{N()})),{loading:K,data:R,error:D,params:I,cancel:()=>x.value.cancel(),refresh:()=>x.value.refresh(),mutate:e=>x.value.mutate(e),run:U,reset:()=>{N(),j.value="__QUERY_DEFAULT_KEY__",P.__QUERY_DEFAULT_KEY__=m(Pe(e,F))},queries:P}}const Ae=e=>(...t)=>{if(pe(e))return Ae(e(...t))();if(me(n=e)&&pe(n.then)&&pe(n.catch))return e;if(fe(e)){const t=e,{url:n}=t,a=d(t,["url"]);return we(n,a)}if("[object String]"===ve(e))return we(e);throw Te("Unknown service type",!0);var n};function Me(e,t="YYYY-MM-DD HH:mm:ss"){return z(e).format(t)}function Ue(e,t="YYYY-MM-DD "){return z(e).format(t)}const Ye=f({props:["bordered","hiddenFilter","url","columns","actions","button","items","model","resKey","scroll"],setup(e){const{hasPermission:t}=ne(),{hasRole:n}=ae(),{data:a,run:r,loading:o,current:l,pageSize:i,total:v,refresh:f}=function(e,t){var n,a;const r=Ae(e),o=Y(se,{}),l=Ie({pagination:{currentKey:"current",pageSizeKey:"pageSize",totalKey:"total",totalPageKey:"totalPage"}},{pagination:null!==(n=de().pagination)&&void 0!==n?n:{}},{pagination:null!==(a=o.pagination)&&void 0!==a?a:{}},null!=t?t:{}),{pagination:{currentKey:i,pageSizeKey:s,totalKey:v,totalPageKey:f},queryKey:m}=l,h=d(l,["pagination","queryKey"]);m&&Te("usePagination does not support concurrent request");const g=Ie({defaultParams:[{[i]:1,[s]:10}]},h),b=Le(r,g),{data:_,params:w,queries:E,run:T,reset:O}=b,k=d(b,["data","params","queries","run","reset"]),S=e=>{const[t,...n]=w.value,a=[u(u({},t),e),...n];T(...a)},C=e=>{S({[i]:e})},F=e=>{S({[s]:e})},K=y(!1),R=p((()=>Ee(_.value,v,0))),D=p({get:()=>{var e,t;return null!==(e=null===(t=w.value[0])||void 0===t?void 0:t[i])&&void 0!==e?e:g.defaultParams[0][i]},set:e=>{C(e)}}),I=p({get:()=>{var e,t;return null!==(e=null===(t=w.value[0])||void 0===t?void 0:t[s])&&void 0!==e?e:g.defaultParams[0][s]},set:e=>{F(e)}}),P=p((()=>Ee(_.value,f,Math.ceil(R.value/I.value))));return u({data:_,params:w,current:D,pageSize:I,total:R,totalPage:P,reloading:K,run:T,changeCurrent:C,changePageSize:F,changePagination:(e,t)=>{S({[i]:e,[s]:t})},reload:()=>c(this,null,(function*(){const{defaultParams:e,manual:t}=g;O(),t||(K.value=!0,yield T(...e),K.value=!1)}))},k)}(e.url,{pagination:{pageSizeKey:"limit",currentKey:"page"}}),m=p((()=>{var t;return null==(t=e.bordered)||t})),h=p((()=>{var t,n;return(null==(n=a.value)?void 0:n[(null==(t=null==e?void 0:e.resKey)?void 0:t.list)||"list"])||[]})),b=p((()=>({total:v.value,current:l.value,pageSize:i.value,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>H("span",{},`共 ${v.value} 条`)}))),_=p((()=>(g(e.actions)||[]).map((e=>{const{popConfirm:a}=e;return s(u(u({type:"link"},e),a||{}),{enable:!!a,permission:t(e.auth)&&n(e.role)})})))),w=p((()=>e.model)),E=p((()=>e.button)),T=p((()=>e.items));return{dataSource:h,loading:o,pagination:b,hasBordered:m,handleTableChange:(e,t,n)=>{r(u({limit:e.pageSize,page:null==e?void 0:e.current,sortField:n.field,sortOrder:n.order},t))},run:r,refresh:f,getActions:_,tableFilterModel:w,tableFilterButton:E,tableFilterItems:T,onSearch:()=>{const e=g(w.value)||{};e&&Object.keys(e).map((t=>{e[t]&&z.isDayjs(e[t])&&(e[t]=Ue(e[t]))})),r(u({page:l.value,limit:i.value},e))},formatDate:(e,t="date")=>{const n="date"===t?Ue:Me;return 10===e.length?n(1e3*Number(e)):n(e)}}}}),qe={class:"table-component"},We={key:0},Ne={key:1},Be={key:2},ze=["type"],He={key:1},Qe=["onClick","type"];const $e=te(Ye,[["render",function(e,t,n,a,r,o){const l=ie,i=J,u=X,s=$;return b(),T("div",qe,[E(l,{button:e.tableFilterButton,items:e.tableFilterItems,model:e.tableFilterModel,hiddenFilter:e.hiddenFilter,pagination:null,onSearch:e.onSearch},null,8,["button","items","model","hiddenFilter","onSearch"]),E(s,{class:Q(["ant-table-striped",{border:e.hasBordered}]),rowClassName:(e,t)=>t%2==1?"table-striped":"",dataSource:e.dataSource,columns:e.columns,rowKey:e=>e.id,pagination:e.pagination,loading:e.loading,onChange:e.handleTableChange,scroll:e.scroll},{bodyCell:w((({column:n,text:a,index:r,record:o})=>["toIndex"===n.key?(b(),T("span",We,O(r+1),1)):k("",!0),"toDate"===n.key?(b(),T("span",Ne,O(a?e.formatDate(a):"-"),1)):k("",!0),"toDateTime"===n.key?(b(),T("span",Be,O(a?e.formatDate(a,"time"):"-"),1)):k("",!0),"action"===n.key?(b(!0),T(K,{key:3},F(e.getActions,((n,a)=>(b(),T(K,{key:`${a}-${n.label}`},[n.enable?(b(),_(i,{key:0,title:null==n?void 0:n.title,onConfirm:e=>null==n?void 0:n.onConfirm(o),onCancel:e=>null==n?void 0:n.onCancel(o)},{default:w((()=>[V("a",{onClick:t[0]||(t[0]=G((()=>{}),["prevent"])),type:n.type},O(n.label),9,ze)])),_:2},1032,["title","onConfirm","onCancel"])):n.permission?(b(),T("a",{key:2,onClick:e=>null==n?void 0:n.onClick(o),type:n.type},O(n.label),9,Qe)):(b(),T("span",He,"——")),a<e.getActions.length-1?(b(),_(u,{key:3,type:"vertical"})):k("",!0)],64)))),128)):k("",!0)])),_:1},8,["class","rowClassName","dataSource","columns","rowKey","pagination","loading","onChange","scroll"])])}],["__scopeId","data-v-19f23b2c"]]);export{$e as _};
